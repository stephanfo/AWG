{% extends "UserBundle::layout.html.twig" %}

{% block title %}
    {{ 'Galerie' | trans }} - {{ parent() }}
{% endblock %}

{% block body %}
    {% if not galleries is empty %}
        {% for gallery in galleries %}
            {% if appConfig.gallerySingleGallery == false or gallery.id == oneGallery or (oneGallery is null and loop.last) %}
                {% if appConfig.galleryQuickLink and appConfig.gallerySingleGallery == false and galleries | length > 1 %}
                    <div class="form-group form-inline gallery-quick-link">
                        <select quickLink-select class="form-control">
                            <option value="0">{{ 'Accès rapide' | trans }}</option>
                            {% for gallery in galleries %}
                                <option value="quickLink-{{ loop.index }}">{{ gallery.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
                <h4 id="quickLink-{{ loop.index }}" class="page-header">{{ gallery.title }} <small>(<i>{{ gallery.photos | length }} {{ 'photos' | trans }})</i></small></h4>
                <p>
                    {{ gallery.detail | raw }}
                </p>
                <p>&nbsp;</p>
                {% if not gallery.photos is empty %}
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="grid" data-columns>
                                {% for photo in gallery.photos %}
                                    <div class="thumbnail">
                                        {% if is_granted('ROLE_BIGPICTURE') %}
                                            <a href="{{ vich_uploader_asset(photo, 'imageFile') }}" data-lightbox="gallery" data-title="Photo {{ photo.title }}, Taille {{ photo.imageWidth }}x{{ photo.imageHeight }}">
                                                <img class="img-responsive" src="{{ vich_uploader_asset(photo, 'imageFile') | imagine_filter('gallery_thumb') }}" alt="{{ photo.title }}"/>
                                            </a>
                                        {% else %}
                                            <img class="img-responsive" src="{{ vich_uploader_asset(photo, 'imageFile') | imagine_filter('gallery_thumb') }}" alt="{{ photo.title }}"/>
                                        {% endif %}
                                        <div class="caption">
                                            <p class="image-caption">
                                                {{ photo.title }}
                                            </p>
                                            <p class="image-caption">
                                                <button type="button" photo-like="{{ photo.id }}" class="btn {% if attribute(likes, photo.id) is defined %}btn-success{% else %}btn-default{% endif %} btn-xs"><i class="glyphicon glyphicon-thumbs-up"></i> <span photo-like-count="{{ photo.id }}">{{ photo.likeCount }}</span></button>
                                                &nbsp;
                                                <button type="button" photo-cart="{{ photo.id }}" class="btn {% if attribute(carts, photo.id) is defined %}btn-primary{% else %}btn-default{% endif %} btn-xs"><i class="glyphicon glyphicon-print"></i></button>
                                            </p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="bottom-block">
                    <div class="bottom-block-right">
                        <a href="{{ path('cart') }}"><button type="button" class="btn btn-success bottom-button"><i class="glyphicon glyphicon-print"></i> {{ 'Définir les formats' | trans }}</button></a>
                    </div>
                </div>
                {% if not loop.last and appConfig.gallerySingleGallery == false %}
                    <hr>
                {% endif %}
            {% endif %}
        {% endfor %}
        {% if appConfig.gallerySingleGallery %}
            <hr>
            <h4>Liste des galeries</h4>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Nom</th>
                    <th style="text-align: center;">Photos</th>
                    <th style="text-align: right;">Go</th>
                </tr>
                </thead>
                <tbody>
                {% for gallery in galleries %}
                    <tr {% if gallery.id == oneGallery %}class="info"{% endif %}>
                        <td>{{ gallery.title }}</td>
                        <td style="text-align: center;">{{ gallery.photos | length }}</td>
                        <td style="text-align: right;"><a href="{{ path('home_one_gallery', { 'oneGallery': gallery.id }) }}"><button type="button" class="btn btn-xs btn-default"><li class="glyphicon glyphicon-arrow-right"></li></button></a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    {% else %}
        {{ 'Aucune galerie accessible' | trans }}
    {% endif %}
    {{ render(controller('UserBundle:Discount:bottomBar')) }}
{% endblock %}

{% block javascripts %}
    <script src="/resources/salvattore/salvattore.min.js"></script>
    <script type="text/javascript">
        $('[photo-cart]').click(function () {
            $.get('{{ path('cart_toggle_empty_link') }}' + $(this).attr('photo-cart'), function (data) {
                if (data['cart'])
                {
                    $('[photo-cart="' + data['id'] + '"]').removeClass('btn-default');
                    $('[photo-cart="' + data['id'] + '"]').addClass('btn-primary');
                } else
                {
                    $('[photo-cart="' + data['id'] + '"]').removeClass('btn-primary');
                    $('[photo-cart="' + data['id'] + '"]').addClass('btn-default');
                }
            });
        });

        $('[photo-like]').click(function () {
            $.get('{{ path('like_toggle_empty_link') }}' + $(this).attr('photo-like'), function (data) {
                if (data['like'])
                {
                    $('[photo-like="' + data['id'] + '"]').removeClass('btn-default');
                    $('[photo-like="' + data['id'] + '"]').addClass('btn-success');
                } else
                {
                    $('[photo-like="' + data['id'] + '"]').removeClass('btn-success');
                    $('[photo-like="' + data['id'] + '"]').addClass('btn-default');
                }
                $('[photo-like-count="' + data['id'] + '"]').text(data['count']);
            });
        });

        $('[quickLink-select]').on('change', function () {
            if (this.value != 0)
            {
                var target = this.value;
                this.value = 0;
                $('html, body').animate({scrollTop: $('#' + target).offset().top }, 1000);
            }
        });
    </script>
    {% if is_granted('ROLE_BIGPICTURE') %}
        <script src="/resources/lightbox/js/lightbox.min.js"></script>
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {% if is_granted('ROLE_BIGPICTURE') %}
        <link href="/resources/lightbox/css/lightbox.min.css" rel="stylesheet">
    {% endif %}
{% endblock %}
